-- Load WindUI
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

-- Ambil nama player
local player = game.Players.LocalPlayer
local playerName = player.Name
local playerDisplayName = player.DisplayName

-- Buat Window versi baru
local Window = WindUI:CreateWindow({
    Title = "Nexa - Premium",
    Icon = "rbxassetid://107488593993096",
    Author = "Fish IT! Script | @ Han",
    Folder = "Hanzo",
    Size = UDim2.fromOffset(540, 420),
    Transparent = true,
    Theme = "Dark",
    
    HidePanelBackground = true,
    NewElements = false,

    User = {
        Enabled = true,
        Anonymous = false,           -- false biar muncul nama asli
        Name = playerDisplayName,    -- Nama tampilan
        UserName = "@" .. playerName, -- Username Roblox
        Callback = function()
            WindUI:Notify({
                Title = "User Profile",
                Content = "User profile clicked!",
                Duration = 3
            })
        end
    },
    
    Acrylic = false,
    HideSearchBar = false,
    SideBarWidth = 200,
})

Window:Tag({
    Title = "v1.2.1",
    Color = Color3.fromHex("#30ff6a")
})


Window:EditOpenButton({
    Enabled = false
})

WindUI:Notify({
    Title = "Game Supported",
    Content = "Dig ðŸ”´, 99 Nights in the Forest ðŸ”´, Fish It ðŸŸ¢, Grow A Garden ðŸ”´",
    Icon = "gamepad",
    Duration = 6
})

task.delay(6.5, function()
    WindUI:Notify({
        Title = "Bug Report",
        Content = "If there are any errors, please let the developer know. Join Discord to report bugs.",
        Icon = "cloud-alert",
        Duration = 6
    })
end)

task.delay(13, function()
    WindUI:Notify({
        Title = "Purchase",
        Content = "If you want to buy this premium script key, join Discord to buy premium.",
        Icon = "shopping-cart",
        Duration = 6
    })
end)

-- âœ… Tab dan UI
local Tabs = {
    Home = Window:Tab({ Title = "Home", Icon = "house"  }),
    Active = Window:Tab({ Title = "Active", Icon = "info"  }),
    Player = Window:Tab({ Title = "Player", Icon = "user"  }),
    Farm = Window:Tab({ Title = "Farm", Icon = "fish"  }),
    Auto = Window:Tab({ Title = "Automaticaly", Icon = "repeat-2"  }),
    Shop = Window:Tab({ Title = "Shop", Icon = "shopping-cart"  }),
    Boat = Window:Tab({ Title = "Boat", Icon = "sailboat"  }),
    Teleport = Window:Tab({ Title = "Teleport", Icon = "map-pin"  }),
    Server = Window:Tab({ Title = "Server", Icon = "server"  }),
    Visual = Window:Tab({ Title = "Visual", Icon = "eye"  }),
}

Tabs.Home:Section({ Title = "Update" })

Tabs.Home:Divider()

Tabs.Home:Paragraph({
    Title = "Here's what's new:",
    Desc = [[
[+] Added Aura Boat Quest
    ]]
})

Tabs.Home:Section({ Title = "Server" })

Tabs.Home:Paragraph({
    Title = "Discord - Nexa | COMMUNITY",
    Desc = "Indonesia ðŸ‡®ðŸ‡©",
    Image = "https://images-eds-ssl.xboxlive.com/image?url=4rt9.lXDC4H_93laV1_eHHFT949fUipzkiFOBH3fAiZZUCdYojwUyX2aTonS1aIwMrx6NUIsHfUHSLzjGJFxxsG72wAo9EWJR4yQWyJJaDaK1XdUso6cUMpI9hAdPUU_FNs11cY1X284vsHrnWtRw7oqRpN1m9YAg21d_aNKnIo-&format=source",
    ImageSize = 20,
    Color = "Grey",
    Buttons = {
        {
            Title = "Copy Link",
            Icon = "copy",
            Variant = "Tertiary",
            Callback = function()
                setclipboard("discord.gg/ECxQFc97F5")
                WindUI:Notify({
                    Title = "Copied!",
                    Content = "Discord link copied to clipboard",
                    Duration = 2
                })
            end
        }
    }
})

Tabs.Active:Section({ Title = "Status" })

-- FPS, Ping, dan Lama di Server ke WindUI Paragraph

local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")

local displayFPS = 0
local accTime, accFrames = 0, 0
local smoothing = 0.15

-- Catat waktu join server
local joinTime = tick()

-- Buat Paragraph di tab Active
local statusParagraph = Tabs.Active:Paragraph({
    Title = "Status Player",
    Desc = "FPS: ...\nPing: ...\nTime: ..."
})

-- Fungsi format waktu (hh:mm:ss)
local function formatTime(seconds)
    local h = math.floor(seconds / 3600)
    local m = math.floor((seconds % 3600) / 60)
    local s = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", h, m, s)
end

-- Update tiap frame
RunService.RenderStepped:Connect(function(dt)
    accTime = accTime + dt
    accFrames = accFrames + 1

    if accTime >= 0.5 then
        local instantFPS = accFrames / accTime
        displayFPS = displayFPS + (instantFPS - displayFPS) * smoothing

        -- Ambil ping (ms)
        local ping = Stats.Network.ServerStatsItem["Data Ping"]:GetValue()

        -- Lama waktu di server
        local elapsed = tick() - joinTime
        local timePlayed = formatTime(elapsed)

        -- Update Paragraph WindUI
        statusParagraph:SetDesc(
            "FPS: " .. math.floor(displayFPS + 0.5) ..
            "\nPing: " .. math.floor(ping) .. " ms" ..
            "\nTime: " .. timePlayed
        )

        accTime = 0
        accFrames = 0
    end
end)


Tabs.Farm:Section({ Title = "Fishing" })

Tabs.Farm:Paragraph({
    Title = "Pesan Developer",
    Desc = "Semisal ada bug di auto Fish v2 pakai auto Fish v1 aja uda di fixed bug tapi masi sama aja"
})

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Net = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")

local player = game.Players.LocalPlayer
local container = player:WaitForChild("PlayerGui")
    :WaitForChild("Small Notification")
    :WaitForChild("Display")
    :WaitForChild("Container")

local initialPos = UDim2.new(0.5, 0, -1.9, 0)

local AutoFish = false
local FishMode = "PERFECT"
local runningCycle = false -- mencegah tumpukan siklus

-- Step 1 â†’ Charge Fishing Rod
local function Step1()
    Net:WaitForChild("RF/ChargeFishingRod"):InvokeServer(os.clock())
end

-- Step 2 â†’ Start Fishing Minigame
local function Step2()
    local args
    if FishMode == "PERFECT" then
        args = { -0.75, 0.9949902531063812 }
    elseif FishMode == "OK" then
        args = { -0.75, 0.3251698002015836 }
    elseif FishMode == "AMAZING" then
        args = { -0.5718746185302734, 0.8702929274284 }
    elseif FishMode == "GREAT" then
        args = { -0.5718746185302734, 0.744264094698844 }
    else
        args = { -0.75, 0.9949902531063812 }
    end
    Net:WaitForChild("RF/RequestFishingMinigameStarted"):InvokeServer(unpack(args))
end

-- Step 4 â†’ Reset rod cepat
local function Step4()
    Net:WaitForChild("RE/UnequipToolFromHotbar"):FireServer()
    task.wait(0.01)
    Net:WaitForChild("RE/EquipToolFromHotbar"):FireServer(1)
    task.wait(0.03)
end

-- Step 3 â†’ Tunggu container berubah atau timeout
local function Step3(callback)
    local connection
    local finished = false

    connection = container:GetPropertyChangedSignal("Position"):Connect(function()
        if container.Position ~= initialPos and not finished then
            finished = true
            connection:Disconnect()
            callback() -- lanjut Step4
        end
    end)

    -- Timeout 7 detik
    task.delay(7, function()
        if not finished then
            finished = true
            if connection and connection.Connected then
                connection:Disconnect()
            end
            -- Container ga berubah â†’ cancel fishing inputs
            Net:WaitForChild("RF/CancelFishingInputs"):InvokeServer()
            callback() -- lanjut Step4
        end
    end)
end

-- Jalankan siklus Auto Fish (serial)
function RunCycle()
    if runningCycle then return end
    runningCycle = true

    task.spawn(function()
        while AutoFish do
            -- Step1
            Step1()
            task.wait(0.18)

            -- Step2
            Step2()

            -- Step3 + Step4
            local step3Finished = false
            Step3(function()
                Step4()
                step3Finished = true
            end)

            -- Tunggu Step3+Step4 selesai sebelum ulang loop
            repeat task.wait() until step3Finished

            -- Delay kecil agar tidak spam server
            task.wait(0.1)
        end
        runningCycle = false
    end)
end

-- UI Dropdown
Tabs.Farm:Dropdown({ 
    Title = "Choose Charge Mode", 
    Values = { "PERFECT", "OK", "AMAZING", "GREAT"}, 
    Value = "PERFECT", 
    Callback = function(option) 
        FishMode = option
    end
})

-- UI Toggle
Tabs.Farm:Toggle({
    Title = "Auto Fish v2",
    Value = false,
    Callback = function(state)
        AutoFish = state
        if state then
            RunCycle()
        end
    end
})

Tabs.Farm:Toggle({
    Title = "Auto Fishing Completed",
    Value = false,
    Callback = function(state)
        if state then
            -- Aktifkan loop auto fishing
            getgenv().AutoFishing = true
            task.spawn(function()
                while getgenv().AutoFishing do
                    pcall(function()
                        game:GetService("ReplicatedStorage")
                            :WaitForChild("Packages")
                            :WaitForChild("_Index")
                            :WaitForChild("sleitnick_net@0.2.0")
                            :WaitForChild("net")
                            :WaitForChild("RE/FishingCompleted")
                            :FireServer()
                    end)
                    task.wait(0.1) -- delay biar server nggak ke-spam terlalu cepat
                end
            end)
        else
            -- Matikan loop auto fishing
            getgenv().AutoFishing = false
        end
    end
})
